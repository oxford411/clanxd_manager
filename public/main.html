<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>clan XD λ§¤λ‹μ €</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="p-4 sm:p-6">
    <div id="loading-overlay" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50">
        <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-primary-color"></div>
    </div>

    <div id="app" class="max-w-screen-xl mx-auto space-y-6 hidden">
        <header class="flex justify-between items-center flex-wrap gap-y-4">
            <h1 class="text-2xl sm:text-3xl font-bold">clan XD λ§¤λ‹μ €</h1>
            <div class="flex items-center gap-2 sm:gap-4">
                <div id="user-info" class="text-sm"></div>
                <div class="flex items-center space-x-2 text-sm admin-only">
                    <label for="admin-mode-toggle">κ΄€λ¦¬μ λ¨λ“</label>
                    <input type="checkbox" id="admin-mode-toggle" class="form-checkbox h-5 w-5 rounded">
                </div>
                <button id="logout-btn" class="btn btn-secondary btn-sm">λ΅κ·Έμ•„μ›ƒ</button>
                <button id="theme-toggle" class="btn btn-secondary p-2"><i data-lucide="sun" class="icon-sm hidden dark-icon"></i><i data-lucide="moon" class="icon-sm light-icon"></i></button>
            </div>
        </header>
        <nav class="border-b border-gray-200 dark:border-gray-700">
            <div class="-mb-px flex flex-wrap" aria-label="Tabs">
                <button class="tab-btn active" data-tab="team-management"><i data-lucide="users" class="icon-xs mr-2"></i>ν€ κ΄€λ¦¬</button>
                <button class="tab-btn" data-tab="user-management"><i data-lucide="user-cog" class="icon-xs mr-2"></i>μ μ € κ΄€λ¦¬</button>
                <button class="tab-btn" data-tab="point-management"><i data-lucide="coins" class="icon-xs mr-2"></i>ν¬μΈνΈ κ΄€λ¦¬</button>
                <button class="tab-btn" data-tab="point-search"><i data-lucide="search" class="icon-xs mr-2"></i>ν¬μΈνΈ κ²€μƒ‰</button>
            </div>
        </nav>
        <main>
            <div id="team-management" class="tab-content active space-y-6">
                 <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="card space-y-4">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold">1. λ μ΄λ“ μ„¤μ •</h3>
                            <button id="toggle-party-settings-btn" class="btn btn-secondary btn-sm text-xs">μλ™ λ¶„λ°° μ„¤μ • (OFF)</button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div><label for="boss-select" class="font-medium text-sm">λ³΄μ¤ μ„ νƒ</label><select id="boss-select" class="select-field mt-1"></select></div>
                            <div><label for="play-time" class="font-medium text-sm">ν”λ μ΄ μ‹κ°„ (μ‹κ°„)</label><input type="number" id="play-time" class="input-field mt-1" value="1" min="0.5" step="0.5"></div>
                            <div class="md:col-span-2"><label for="total-players" class="font-medium text-sm">μ΄ μΈμ›μ</label><input type="number" id="total-players" class="input-field mt-1" value="8" min="1"></div>
                        </div>
                        <div id="manual-party-settings-wrapper" class="space-y-2 pt-4 border-t border-gray-600 mt-4 hidden">
                            <label for="party-count" class="font-medium text-sm">νν‹° λ¶„λ°° μ„¤μ •</label>
                            <div class="flex items-center gap-4">
                                <select id="party-count" class="select-field">
                                    <option value="2">2κ° νν‹°</option>
                                    <option value="3">3κ° νν‹°</option>
                                    <option value="4">4κ° νν‹°</option>
                                </select>
                                <div id="party-size-inputs" class="flex-grow flex items-center gap-2"></div><span id="party-size-validation" class="text-sm font-semibold"></span>
                            </div>
                        </div>
                    </div>
                    <div class="card space-y-4"><h3 class="text-lg font-semibold">2. μ•„μ΄ν… μ •λ³΄</h3><div id="item-pick-section" class="space-y-2"></div></div>
                </div>
                <div class="card">
                    <div class="flex justify-between items-center mb-4 flex-wrap gap-2">
                        <div class="flex items-center gap-3">
                            <h3 class="text-lg font-semibold">3. νν‹°μ› μ •λ³΄ μ…λ ¥</h3>
                            <span id="item-dupe-warning" class="text-sm font-bold text-red-400 hidden"></span>
                        </div>
                        <div class="flex items-center gap-2">
                            <button id="grant-points-from-team-btn" class="btn btn-primary btn-sm admin-only"><i data-lucide="coins" class="icon-xs mr-2"></i>μ°Έκ°€ μΈμ› ν¬μΈνΈ λ¶€μ—¬</button>
                            <button id="reset-party-info-btn" class="btn btn-danger btn-sm"><i data-lucide="trash-2" class="icon-xs mr-2"></i>μ •λ³΄ μ΄κΈ°ν™”</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-gray-700 text-gray-300">
                                <tr>
                                    <th class="p-2 w-10">#</th>
                                    <th class="p-2 w-16 text-center">νƒ€μΈ<br>μ§μ—…</th>
                                    <th class="p-2 w-48">μ°Έκ°€μ JN ID</th>
                                    <th class="p-2 w-48">μ§μ—… μ†μ μ JN ID</th>
                                    <th class="p-2 w-32">μ§μ—… μ„ νƒ</th>
                                    <th class="p-2 w-20 text-center">μ§μ—…</th>
                                    <th class="p-2 w-28">μ§μ—… λ¶„λ¥</th>
                                    <th class="p-2 item-pick-header">μ•„μ΄ν… ν”½</th>
                                </tr>
                            </thead>
                            <tbody id="player-input-table"></tbody>
                        </table>
                    </div>
                </div>
                <div id="distribute-btn-wrapper" class="flex justify-center hidden"><button id="distribute-party-btn" class="btn btn-primary text-base"><i data-lucide="shuffle" class="mr-2"></i>μλ™ νν‹° λ¶„λ°° μ‹¤ν–‰</button></div>
                <div id="party-result-section" class="hidden space-y-6">
                     <h2 class="text-xl font-bold text-center">π‰ μλ™ νν‹° λ¶„λ°° μ μ• π‰</h2>
                     <p class="text-center text-sm text-gray-400">νν‹°μ›μ„ λ“λκ·Έν•μ—¬ μλ¦¬λ¥Ό λ°”κΏ€ μ μμµλ‹λ‹¤.</p>
                     <div id="party-suggestions" class="grid grid-cols-1 xl:grid-cols-2 gap-6"></div>
                </div>
            </div>
            
            <div id="user-management" class="tab-content space-y-6">
                <div id="approval-section" class="card admin-only">
                    <h3 class="text-lg font-semibold mb-4">κ°€μ… μΉμΈ λ€κΈ° λ©λ΅</h3>
                    <div id="approval-list" class="space-y-4"></div>
                </div>
                <div class="card">
                    <h3 class="text-lg font-semibold mb-4">μ „μ²΄ μ μ € λ©λ΅</h3>
                    <div id="user-list" class="space-y-4"></div>
                </div>
            </div>

            <div id="point-management" class="tab-content space-y-6">
                 <div class="card admin-only">
                    <h3 class="text-lg font-semibold mb-4">ν¬μΈνΈ μ΄μ „</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                        <div class="autocomplete-container"><label for="transfer-from-id" class="font-medium text-sm">λ³΄λ‚΄λ” μ μ € (JN ID)</label><input type="text" id="transfer-from-id" class="input-field mt-1" placeholder="ID μ…λ ¥"></div>
                        <div class="autocomplete-container"><label for="transfer-to-id" class="font-medium text-sm">λ°›λ” μ μ € (JN ID)</label><input type="text" id="transfer-to-id" class="input-field mt-1" placeholder="ID μ…λ ¥"></div>
                        <div><label for="transfer-amount" class="font-medium text-sm">μ΄μ „ν•  ν¬μΈνΈ</label><input type="number" step="0.1" id="transfer-amount" class="input-field mt-1" placeholder="μ: 10"></div>
                        <button id="transfer-points-btn" class="btn btn-primary">μ΄μ „</button>
                    </div>
                </div>
                <div class="card admin-only">
                    <h3 class="text-lg font-semibold mb-4">κ°μΈ ν¬μΈνΈ μ΅°μ •</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                        <div class="autocomplete-container"><label for="manual-point-id" class="font-medium text-sm">λ€μƒ JN ID</label><input type="text" id="manual-point-id" class="input-field mt-1" placeholder="ID μ…λ ¥"></div>
                        <div><label for="manual-point-change" class="font-medium text-sm">ν¬μΈνΈ λ³€λ™λ‰</label><input type="number" step="0.1" id="manual-point-change" class="input-field mt-1" placeholder="μ: 1.5 λλ” -1"></div>
                        <div><label for="manual-point-reason" class="font-medium text-sm">μ‚¬μ </label><input type="text" id="manual-point-reason" class="input-field mt-1" placeholder="μ: μ΄λ²¤νΈ λ³΄μƒ"></div>
                        <button id="manual-apply-points-btn" class="btn btn-primary">μ μ©</button>
                    </div>
                </div>
                <div class="card admin-only">
                    <h3 class="text-lg font-semibold mb-4">μΌκ΄„ ν¬μΈνΈ μ΅°μ •</h3>
                    <div class="flex flex-wrap gap-4 items-end">
                        <div class="flex-grow"><label for="point-change" class="font-medium text-sm">ν¬μΈνΈ λ³€λ™λ‰</label><input type="number" id="point-change" step="0.1" class="input-field mt-1" placeholder="μ: 1.5 λλ” -0.5"></div>
                        <div class="flex-grow"><label for="point-reason" class="font-medium text-sm">μ‚¬μ </label><input type="text" id="point-reason" class="input-field mt-1" placeholder="μ: λ μ΄λ“ μ°Έμ—¬"></div>
                        <button id="apply-points-btn" class="btn btn-primary">μ„ νƒ μΈμ› μ μ©</button>
                    </div>
                </div>
                <div class="card">
                    <div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold">μ „μ²΄ μ μ € ν¬μΈνΈ ν„ν™©</h3><span id="checked-user-count" class="text-sm font-semibold text-gray-400"></span></div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-gray-700 text-gray-300">
                                <tr>
                                    <th class="p-2 w-10">#</th><th class="p-2 w-12"><input type="checkbox" id="select-all-users" class="admin-only"></th><th class="p-2">JN ID</th><th class="p-2">ν„μ¬ ν¬μΈνΈ</th><th class="p-2">μµκ·Ό λ³€λ™</th>
                                </tr>
                            </thead>
                            <tbody id="point-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="point-search" class="tab-content space-y-6">
                 <div class="card">
                    <h3 class="text-lg font-semibold mb-4">νΉμ • μ μ € ν¬μΈνΈ μ΄λ ¥ κ²€μƒ‰ (JN ID)</h3>
                    <div class="flex gap-4 autocomplete-container">
                        <input type="text" id="search-user-id" class="input-field" placeholder="κ²€μƒ‰ν•  JN IDλ¥Ό μ…λ ¥ν•μ„Έμ”."><button id="search-points-btn" class="btn btn-primary"><i data-lucide="search" class="icon-xs mr-2"></i>κ²€μƒ‰</button>
                    </div>
                </div>
                <div id="search-result-card" class="card hidden">
                     <h3 class="text-lg font-semibold mb-4"><span id="searched-id-display"></span>λ‹μ ν¬μΈνΈ μ΄λ ¥</h3>
                     <p class="mb-4">ν„μ¬ ν¬μΈνΈ: <span id="current-points-display" class="font-bold text-lg"></span></p>
                     <div class="overflow-x-auto">
                         <table class="w-full text-sm text-left"><thead class="bg-gray-700 text-gray-300"><tr><th class="p-2">μ‹κ°„</th><th class="p-2">λ³€λ™λ‰</th><th class="p-2">μ‚¬μ </th><th class="p-2">λ„μ  ν¬μΈνΈ</th></tr></thead><tbody id="point-log-table-body"></tbody></table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="character-editor-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-40 hidden">
        <div class="card w-full max-w-2xl">
            <h3 class="text-lg font-semibold mb-4">μΊλ¦­ν„° μ •λ³΄ μμ •: <span id="editing-jn-id"></span></h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end mb-4">
                <div>
                    <label for="modal-char-stat" class="font-medium text-sm">μ§μ—… μ†μ„±</label>
                    <select id="modal-char-stat" class="select-field mt-1"><option value="">μ†μ„± μ„ νƒ</option></select>
                </div>
                <div class="md:col-span-2">
                    <label for="modal-char-job" class="font-medium text-sm">μ§μ—…</label>
                    <div class="flex items-center gap-2">
                        <select id="modal-char-job" class="select-field mt-1" disabled></select>
                        <button type="button" id="modal-add-character-btn" class="btn btn-secondary flex-shrink-0">μ¶”κ°€</button>
                    </div>
                </div>
            </div>
            <div id="modal-registered-characters" class="mt-4 space-y-2 border-t border-gray-600 pt-4">
            </div>
            <div class="flex justify-end gap-4 mt-6">
                <button id="modal-close-btn" class="btn btn-secondary">λ‹«κΈ°</button>
                <button id="modal-save-btn" class="btn btn-primary">μ €μ¥</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="main.js" defer></script>
</body>
</html>
